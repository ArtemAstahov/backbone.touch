/*!
 * backbone.touch - v0.3.0
 * Copyright 2012, Raymond Julin (@nervetattoo)
 * backbone.touch.js may be freely distributed under the MIT license.
 */!function(a){"use strict";"function"==typeof define&&define.amd?define(["underscore","backbone"],a):a(_,Backbone)}(function(a,b){"use strict";var c=c||{},d=function(b,c){return b&&b[c]?a.isFunction(b[c])?b[c]():b[c]:null},e=/^(\S+)\s*(.*)$/,f=b.View,g=f.extend({options:a.extend({},f.prototype.options,{touch:{fastclick:"undefined"==typeof c.FastClick}}),events:a.extend({},f.prototype.events,{touchstart:"_touchstart",touchmove:"_touchmove",touchend:"_touchend"}),initialize:function(){return this.options.touch=this.options.touch||{},this.options.touch.fastclick&&this.fastClick(this.events),f.prototype.initialize.apply(this,arguments)},_touchstart:function(b){var c=a.inArray("touch",this.options.monitor);c&&(a.inDebug()&&console.log("touchstart",b),this.trigger("touchstart",b),this.touchstart&&this.touchstart(b))},_touchmove:function(b){var c=a.inArray("touch",this.options.monitor);c&&(b.preventDefault&&b.preventDefault(),a.inDebug()&&console.log("touchmove",b),this.trigger("touchmove",b),this.touchmove&&this.touchmove(b))},_touchend:function(b){var c=a.inArray("touch",this.options.monitor);c&&(a.inDebug()&&console.log("touchend",b),this.trigger("touchend",b),this.touchend&&this.touchend(b))},_touch_findEl:function(a,b){var c={top:0,left:0},d=null,e=this.$;return this.$(a).each(function(){var a=e(this).offset();b.top-a.top>=0&&a.top>=c.top&&(c=a,d=this)}),d},_touching:!1,touchPrevents:!0,touchThreshold:10,isTouch:"ontouchstart"in document&&!("callPhantom"in c),fastClick:function(b){if(this.isTouch&&(b||(b=d(this,"events")))){{var c=this;".delegateEvents"+this.cid}a(b).each(function(d,f){if(a.isFunction(d)||(d=this[b[f]]),!d)throw new Error('Method "'+b[f]+'" does not exist');var g=f.match(e),h=g[1],i=g[2],j=a.bind(c._touchHandler,c);d=a.bind(d,c),"click"===h&&(this.$el.off("click",i),this.$el.on("touchstart",i,j),this.$el.on("touchend",i,{method:d},j))},this)}},_touchHandler:function(a){if("changedTouches"in a.originalEvent){var b=a.originalEvent.changedTouches[0],c=b.clientX,d=b.clientY;switch(a.type){case"touchstart":this._touching=[c,d];break;case"touchend":var e=this._touching[0],f=this._touching[1],g=this.touchThreshold;if(e+g>c&&c>e-g&&f+g>d&&d>f-g){if(this._touching=!1,this.touchPrevents){var h=a.currentTarget.tagName;("BUTTON"===h||"A"===h)&&(a.preventDefault(),a.stopPropagation())}a.data.method(a)}}}}});return a.mixin({inArray:function(a,b){return b.indexOf(a)>-1},inDebug:function(){return"undefined"!=typeof DEBUG&&DEBUG}}),b.View=g,b});